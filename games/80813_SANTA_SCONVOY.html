<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ„ è–èª•éšŠä¼éŠæˆ² ğŸ„</title>
    <style>
        /* --- è–èª• 8-bit é¢¨æ ¼ CSS --- */
        body {
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            /* æ·±è—è‰²èƒŒæ™¯ï¼Œæ¨¡æ“¬è–èª•å¤œ */
            background-color: #0A192F; 
            color: #EFEFEF;
            margin: 0;
        }

        .game-container {
            text-align: center;
            padding: 20px;
            /* è–èª•ç´…é‚Šæ¡† */
            background: #4B0000; 
            border: 5px ridge #C0C0C0; /* éŠ€è‰²å…‰æ¾¤ */
            box-shadow: 0 0 0 8px #181D26;
            margin-bottom: 20px;
        }

        h1 {
            /* ç¯€æ—¥é‡‘è‰²/é»ƒè‰² */
            color: #FFD700; 
            text-shadow: 2px 2px #333;
        }

        #score-display {
            font-size: 1.8em;
            font-weight: bold;
            /* è–èª•ç¶ è‰² */
            color: #008000; 
            margin-bottom: 15px;
            text-shadow: 1px 1px #000;
        }

        #gameCanvas {
            border: 3px solid #666;
            /* è–èª•å¤œå…‰/é›ªåœ°èƒŒæ™¯ */
            background-color: #B0E0E6; 
            image-rendering: pixelated; 
            box-shadow: inset 0 0 10px #000;
        }
        
        /* éŠæˆ²çµæŸ/é–‹å§‹ è¦†è“‹å±¤ */
        #overlay {
            position: absolute;
            width: 400px;
            height: 400px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7); 
            /* æº«æš–çš„æ·ºè‰² */
            color: #FFFAFA; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            border: 2px dashed #C0C0C0; /* éŠ€è‰²è™›ç·š */
        }

        #overlay-message {
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        #startButton {
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
            /* é®®ç´…è‰²æŒ‰éˆ• */
            background: #CC0000; 
            color: #FFF;
            border: 3px solid #008000; /* ç¶ è‰²é‚Šæ¡† */
            box-shadow: 2px 2px #000;
            font-weight: bold;
            transition: background-color 0.1s;
        }

        #startButton:hover {
            background-color: #AA0000;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>[ S A N T A ' S   C O N V O Y ]</h1>
        <div id="score-display">éšŠä¼äººæ•¸: 1</div>

        <canvas id="gameCanvas" width="400" height="400"></canvas>
        
        <div id="overlay">
            <h2 id="overlay-message">é»æ“Šé–‹å§‹éŠæˆ²</h2>
            <button id="startButton">é–‹å§‹/é‡æ–°é–‹å§‹</button>
        </div>
    </div>

    <script>
        // --- JavaScript éŠæˆ²é‚è¼¯ ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score-display');
        const overlay = document.getElementById('overlay');
        const overlayMessage = document.getElementById('overlay-message');
        const startButton = document.getElementById('startButton');

        const TILE_SIZE = 20; // æ¯å€‹æ–¹å¡Šçš„å¤§å°
        const COLS = canvas.width / TILE_SIZE;
        const ROWS = canvas.height / TILE_SIZE;
        
        // éŠæˆ²æ ¸å¿ƒè®Šæ•¸
        let team; 
        let powerUp; // ç¦®ç‰©
        let dx; 
        let dy; 
        let teamSize; 
        let gameInterval; 
        let isPaused = true;
        let baseSpeed = 150; 
        const speedFactor = 5; 

        // --- ç¹ªè£½å‡½å¼ ---
        function drawSquare(x, y, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
            // 8-bit é¢¨æ ¼é‚Šæ¡†
            ctx.strokeStyle = '#000'; 
            ctx.strokeRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
        }

        function drawGame() {
            // ç¹ªè£½èƒŒæ™¯ (é›ªåœ°/å¤œç©º)
            ctx.fillStyle = '#B0E0E6';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç¹ªè£½é“å…·/ç¦®ç‰© (é‡‘è‰²/é»ƒè‰²)
            drawSquare(powerUp.x, powerUp.y, '#FFD700');

            // ç¹ªè£½éšŠä¼æˆå“¡
            team.forEach((segment, index) => {
                // éšŠé•· (è–èª•ç´… - Santa Red)
                const color = index === 0 ? '#CC0000' : '#008000'; // éšŠé•·(ç´…) vs éšŠå“¡(ç¶ )
                drawSquare(segment.x, segment.y, color);
            });
        }
        
        // --- é“å…·/ç¦®ç‰©æ”¾ç½®é‚è¼¯ ---
        function placePowerUp() {
            let randX, randY, onTeam;

            do {
                randX = Math.floor(Math.random() * COLS);
                randY = Math.floor(Math.random() * ROWS);
                
                onTeam = team.some(segment => segment.x === randX && segment.y === randY);
            } while (onTeam);
            
            powerUp = { x: randX, y: randY };
        }

        // --- é€Ÿåº¦è¨ˆç®—é‚è¼¯ ---
        function calculateSpeed() {
            let newSpeed = baseSpeed - ((teamSize - 1) * speedFactor); 
            return Math.max(newSpeed, 50); 
        }

        // --- éŠæˆ²è¿´åœˆ ---
        function gameLoop() {
            if (isPaused) return;

            // 1. æ›´æ–°ä½ç½®
            const head = { x: team[0].x + dx, y: team[0].y + dy };
            team.unshift(head);

            // 2. æª¢æŸ¥ç¢°æ’
            if (checkCollision()) {
                gameOver();
                return;
            }
            
            // 3. æª¢æŸ¥ç¦®ç‰©
            if (head.x === powerUp.x && head.y === powerUp.y) {
                teamSize++;
                scoreDisplay.textContent = `éšŠä¼äººæ•¸: ${teamSize}`;
                placePowerUp(); 
                
                // *** é€Ÿåº¦å¢åŠ é‚è¼¯ä¿æŒä¸è®Š ***
                const currentSpeed = calculateSpeed();
                clearInterval(gameInterval);
                gameInterval = setInterval(gameLoop, currentSpeed);
            } else {
                team.pop(); 
            }
            
            // 4. ç¹ªè£½ç•«é¢
            drawGame();
        }

        // --- ç¢°æ’æª¢æŸ¥ (æ’ç‰†å’Œæ’éšŠå“¡) ---
        function checkCollision() {
            const head = team[0];
            
            // æ’ç‰†
            const hitWall = head.x < 0 || head.x >= COLS || 
                            head.y < 0 || head.y >= ROWS;
            if (hitWall) return true;

            // æ’éšŠå“¡ 
            for (let i = 1; i < team.length; i++) {
                if (head.x === team[i].x && head.y === team[i].y) {
                    return true;
                }
            }
            
            return false;
        }

        // --- éŠæˆ²çµæŸ ---
        function gameOver() {
            clearInterval(gameInterval);
            isPaused = true;
            overlayMessage.innerHTML = `è–èª•è€äººæ’è»Šäº†ï¼<br>æœ€çµ‚éšŠä¼äººæ•¸: ${teamSize}`;
            overlay.classList.remove('hidden');
        }

        // --- åˆå§‹åŒ–éŠæˆ² ---
        function initGame() {
            team = [{ x: 10, y: 10 }]; 
            dx = 1; 
            dy = 0;
            teamSize = 1;
            scoreDisplay.textContent = `éšŠä¼äººæ•¸: ${teamSize}`;
            isPaused = false;
            
            overlay.classList.add('hidden');
            placePowerUp();
            drawGame(); 
            
            if (gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(gameLoop, baseSpeed); 
        }

        // --- éµç›¤äº‹ä»¶ç›£è½ ---
        document.addEventListener('keydown', changeDirection);

        function changeDirection(event) {
            if (isPaused) return;

            const key = event.key;
            
            const goingUp = dy === -1;
            const goingDown = dy === 1;
            const goingRight = dx === 1;
            const goingLeft = dx === -1;

            if (key === 'ArrowLeft' && !goingRight) {
                dx = -1; dy = 0;
            } else if (key === 'ArrowUp' && !goingDown) {
                dx = 0; dy = -1;
            } else if (key === 'ArrowRight' && !goingLeft) {
                dx = 1; dy = 0;
            } else if (key === 'ArrowDown' && !goingUp) {
                dx = 0; dy = 1;
            }
        }

        // --- é–‹å§‹æŒ‰éˆ•äº‹ä»¶ ---
        startButton.addEventListener('click', initGame);

        // åˆå§‹è¼‰å…¥
        window.onload = function() {
            // é¡¯ç¤ºæ­¡è¿ç•«é¢
            overlayMessage.innerHTML = "ğŸ„ è–èª•éšŠä¼éŠæˆ² ğŸ<br>æ”¶é›†ç¦®ç‰©ï¼Œå£¯å¤§ä½ çš„éšŠä¼ï¼";
            overlay.classList.remove('hidden');
            scoreDisplay.textContent = "éšŠä¼äººæ•¸: 1";
            
            // åˆå§‹ç¹ªåœ–ï¼ˆæ¸…ç©ºç•«å¸ƒï¼‰
            ctx.fillStyle = '#B0E0E6';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        };
    </script>
</body>
</html>